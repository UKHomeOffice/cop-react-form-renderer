<!-- Global imports -->
import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import { Details, Heading, Link } from '@ukhomeoffice/cop-react-components';
import withMock from 'storybook-addon-mock';

<!-- Local imports -->
import { addHook } from '../../hooks/useHooks';
import FormRenderer from './FormRenderer';

<!-- JSON documents -->
import CIVIL_SERVANT from '../../json/areYouACivilServant.json';
import GRADE from '../../json/grade.json';
import TEAMS from '../../json/team.json';
import USER_PROFILE_DATA from '../../json/userProfile.data.json';
import USER_PROFILE from '../../json/userProfile.json';
import SAVE_AND_CONTINUE from '../../json/saveAndContinue.json';

<Meta title="Components/Form renderer" id="D-FormRenderer" component={ FormRenderer } decorators={[withMock]} />

<Heading size="xl" caption="Components">Form renderer</Heading>

Renders a form with <Link href="https://ukhomeoffice.github.io/cop-react-components/?path=/docs/d-alert--default-story">COP React components</Link>,
on the basis of a <Link href="/?path=/docs/f-json-form">JSON</Link> that describes which elements are required.

<Canvas withToolbar>
  <Story name="Default" parameters={{
    mockData: [
      {
        url: `${USER_PROFILE_DATA.environmentContext.referenceDataUrl}/v2/entities/areYouACivilServant`,
        method: 'GET',
        status: 200,
        response: CIVIL_SERVANT
      },
      {
        url: `${USER_PROFILE_DATA.environmentContext.referenceDataUrl}/v2/entities/grade`,
        method: 'GET',
        status: 200,
        response: GRADE
      },
      {
        url: `${USER_PROFILE_DATA.environmentContext.referenceDataUrl}/v1/entities/team`,
        method: 'GET',
        status: 200,
        response: TEAMS
      }
    ]
  }}>
    {() => {
      return (
        <FormRenderer {...USER_PROFILE} data={USER_PROFILE_DATA} />
      );
    }}
  </Story>
</Canvas>

<Details summary="Properties" className="no-indent">
  <ArgsTable of={ FormRenderer } />
</Details>

## Custom hooks

<Canvas>
  <Story name="Save and continue">
    {() => {
      addHook('onRequest', (req) => {
        // Do whatever you need to do to the request in here, such as adding an Authorization header.
        console.log('onRequest hook called');
        return req;
      });
      addHook('onFormLoad', () => {
        console.log('onFormLoad called');
      });
      addHook('onPageChange', (pageId) => {
        console.log('onPageChange called', pageId);
      });
      
      /**
       * In whatever consumes this, do it as:
       *   intercepts.add('onSubmit', (...) => { ... })
       */
      addHook('onSubmit', (type, payload, onSuccess, onError) => {
        console.log('onSubmit called of type', type, 'called, with the payload', payload);
        onSuccess();
      });
      return (
        <FormRenderer {...SAVE_AND_CONTINUE} data={{}} />
      );
    }}
  </Story>
</Canvas>
